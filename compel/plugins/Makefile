ccflags-y		+= -iquote $(obj)/include/
ccflags-y		+= -iquote $(SRC_DIR)/criu/include
ccflags-y		+= -fPIC

#
# STD plugin
target			+= std
std-obj-y		+= std/std.o
std-obj-y		+= std/string.o

AV			:= $$$$

std-syscalls-codes	+= $(obj)/include/uapi/std/syscall-codes.h
std-syscalls-proto	+= $(obj)/include/uapi/std/syscall.h
std-syscalls-def	+= $(obj)/std/arch/$(ARCH)/syscalls/syscall_64.tbl

$(std-syscalls-codes): $(std-syscalls-def)
	$(call msg-gen, $@)
	$(Q) echo "/* Autogenerated, don't edit */"			>  $@
	$(Q) echo "#ifndef __ASM_CR_SYSCALL_CODES_H_64__"		>> $@
	$(Q) echo "#define __ASM_CR_SYSCALL_CODES_H_64__"		>> $@
	$(Q) cat $< | awk '/^__NR/{SYSN=$(AV)1;				\
		sub("^__NR", "SYS", SYSN);				\
		print "\n#ifndef ", $(AV)1;				\
		print "#define", $(AV)1, $(AV)2;			\
		print "#endif";						\
		print "\n#ifndef ", SYSN;				\
		print "#define ", SYSN, $(AV)1;				\
		print "#endif";}'					>> $@
	$(Q) echo "#endif /* __ASM_CR_SYSCALL_CODES_H_64__ */"		>> $@

$(std-syscalls-proto): $(std-syscalls-def)
	$(call msg-gen, $@)
	$(Q) echo "/* Autogenerated, don't edit */"			>  $@
	$(Q) echo "#ifndef __ASM_CR_SYSCALL_PROTO_H___"			>> $@
	$(Q) echo "#define __ASM_CR_SYSCALL_PROTO_H___"			>> $@
	$(Q) echo '#include "syscall-codes.h"'				>> $@
	$(Q) cat $< | awk '/^__NR/{print "extern long", $(AV)3,	\
			substr($(AV)0, index($(AV)0,$(AV)4)), ";"}'	>> $@
	$(Q) echo "#endif /* __ASM_CR_SYSCALL_PROTO_H__ */"	>> $@

#
# Syscalls generation for STD plugin
#$(addprefix $(obj)/,$(std-obj-y)): $(std-syscalls-codes) $(std-syscalls-proto)

#
# 
